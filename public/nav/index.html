<!-- /nav/index.html -->
<header class="site-header">
  <div class="container nav-inner" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.75rem 0;">
    
    <!-- Brand / Home -->
    <a href="/" class="brand" style="font-weight:800;line-height:1;display:flex;align-items:center;gap:.5rem;color:#fff;text-decoration:none;">
      <img src="/assets/cleantextlogo.png"
           alt="Square Bidness"
           style="height:32px;width:auto;object-fit:contain;">
      <span class="sr-only">Square Bidness</span>
    </a>

    <!-- Nav links -->
    <nav class="main-nav" aria-label="Main Navigation">
      <ul style="display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin:0;padding:0;list-style:none;">
        <li>
          <a href="/shop/" class="main-nav__link" style="color:#fff;text-decoration:none;font-weight:600;">
            Shop
          </a>
        </li>

        <li>
          <a href="/shop/#vsop" class="main-nav__link" style="color:#fff;text-decoration:none;font-weight:600;">
            VSOP Collection
          </a>
        </li>

        <li>
          <a href="/cart/" class="main-nav__link" style="color:#fff;text-decoration:none;font-weight:600;position:relative;display:inline-flex;align-items:center;">
            Cart
            <span id="cart-count"
                  style="display:none;margin-left:.4rem;background:#c9a227;color:#111;border-radius:999px;padding:.15rem .45rem;font-size:.75rem;font-weight:700;line-height:1;">
              0
            </span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <style>
    .site-header{
      background:#000;
      border-bottom:1px solid #1f1f1f;
    }
    @media(max-width:480px){
      .main-nav__link{font-size:.9rem;}
    }
    .main-nav a.active{
      color:#c9a227;
      text-decoration:underline;
      text-underline-offset:3px;
    }
  </style>

  <script>
    (function(){
      // normalize current path like "/shop/"
      const here = location.pathname.replace(/\/+$/,'/') || '/';

      // add "active" state to current page link
      document.querySelectorAll('.main-nav a').forEach(a=>{
        const href = a.getAttribute('href') || '';
        if (!href) return;
        const norm = href.replace(/\/+$/,'/') || '/';

        // rule:
        // - if link is "/" then only match homepage
        // - else highlight if current path starts with link path
        const isHome    = norm === '/';
        const isMatch   = isHome ? (here === '/') : here.startsWith(norm);

        if (isMatch) {
          a.classList.add('active');
          a.setAttribute('aria-current','page');
        }
      });

      // hydrate cart badge from localStorage
      try {
        const KEY   = 'sb_cart_v1';
        const badge = document.getElementById('cart-count');
        if (!badge) return;

        function updateBadge(cartArr){
          const totalQty = cartArr.reduce((sum,i)=> {
            const q = Number(i.qty ?? i.quantity ?? 0);
            return sum + (isNaN(q) ? 0 : q);
          }, 0);

          if (totalQty > 0){
            badge.textContent = totalQty;
            badge.style.display = 'inline-block';
          } else {
            badge.style.display = 'none';
          }
        }

        const cartNow = JSON.parse(localStorage.getItem(KEY) || '[]');
        updateBadge(cartNow);

        // listen for cart update events (our add-to-cart scripts dispatch these)
        window.addEventListener('sb:cart:update', e=>{
          const latestCart = e.detail?.cart || [];
          updateBadge(latestCart);
        });
      } catch(e){}
    })();
  </script>
</header>
