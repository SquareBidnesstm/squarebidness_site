<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart — Square Bidness</title>
  <link rel="canonical" href="https://www.squarebidness.com/cart/" />

  <!-- Perf -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://www.google-analytics.com" />
  <script defer src="/scripts/ga.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="/styles/style.css" />

  <!-- Icons / PWA -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="apple-touch-icon" href="/assets/icons/icon-180.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta name="theme-color" content="#000000" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Square Bidness" />
  <meta property="og:title" content="Your Cart — Square Bidness" />
  <meta property="og:description" content="Review items in your Square Bidness cart and proceed to checkout." />
  <meta property="og:url" content="https://www.squarebidness.com/cart/" />
  <meta property="og:image" content="https://www.squarebidness.com/assets/sb-social-card_1200.jpg" />

  <!-- Org JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "@id":"https://www.squarebidness.com/#org",
    "name":"Square Bidness Apparel",
    "url":"https://www.squarebidness.com/",
    "logo":"https://www.squarebidness.com/assets/cleantextlogo.png",
    "sameAs":[
      "https://instagram.com/squarebidnesstm",
      "https://www.tiktok.com/@squarebidnesstm",
      "https://www.facebook.com/squarebidnessapparel",
      "https://bsky.app/profile/squarebidnesstm.bsky.social",
      "https://www.linkedin.com/company/square-bidness-apparel"
    ],
    "contactPoint":[{
      "@type":"ContactPoint",
      "contactType":"customer support",
      "email":"squarebidnessapparel@gmail.com",
      "areaServed":"US"
    }]
  }
  </script>

  <style>
    .cart-line{display:flex;gap:.75rem;align-items:center;border:1px solid #1f1f1f;border-radius:10px;padding:.5rem .75rem;margin:.4rem 0}
    .cart-line img{width:56px;height:56px;object-fit:cover;border-radius:8px;border:1px solid #1f1f1f}
    .muted{color:#bdbdbd}
    .cta-row{display:flex;gap:.6rem;flex-wrap:wrap}
  </style>
</head>
<body class="theme-dark">
  <!-- NAV -->
  <div id="nav-placeholder"></div>

  <main class="section">
    <div class="container">
      <h1>Your Cart</h1>
      <div id="cart"></div>
      <div class="cta-row" style="margin-top:1rem">
        <!-- If you use Stripe Payment Links, point this directly to the link -->
        <a class="btn btn--gold" id="checkout" href="/checkout/">Proceed to Checkout</a>
        <a class="btn btn--ghost" href="/shop/">Continue Shopping</a>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <div id="footer-placeholder"></div>

  <script>
(async () => {
  const bust = `?v=${Date.now()}`;
  async function inject(url, id) {
    try {
      const r = await fetch(url + bust, { cache:"no-store", credentials:"same-origin" });
      if (!r.ok) return;
      document.getElementById(id).innerHTML = await r.text();
    } catch {}
  }
  await inject("/nav/index.html", "nav-placeholder");
  await inject("/footer/index.html", "footer-placeholder");

  // ✅ Cart read helper — supports older/newer keys + migrates to sb_cart_v1
  function readCartAnyKey(){
    const CANDIDATES = ["sb_cart_v1", "sb_cart_v2", "sb_cart", "cart", "sbCart"];
    for (const key of CANDIDATES) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) continue;
        const parsed = JSON.parse(raw);

        // Some carts store {items:[...]} instead of [...]
        const items = Array.isArray(parsed) ? parsed
                    : (parsed && Array.isArray(parsed.items)) ? parsed.items
                    : null;

        if (items && items.length) return { key, items };
      } catch {}
    }
    return { key: null, items: [] };
  }

  function normalize(items){
    return (items || []).map(it => ({
      id: it.id || it.sku || it.productId || it.name || "item",
      sku: it.sku || it.id || "",
      name: it.name || it.title || it.sku || it.id || "Item",
      image: it.image || it.img || "",
      price: Number(it.price || 0),
      qty: Number(it.quantity || it.qty || 1)
    })).filter(it => it.qty > 0);
  }

  const el = document.getElementById("cart");
  const found = readCartAnyKey();
  const cart = normalize(found.items);

// ✅ Only migrate if we actually found items
if (cart.length) {
  try {
    localStorage.setItem("sb_cart_v1", JSON.stringify(cart));
  } catch {}
}

if (!cart.length) {
  el.innerHTML = '<p class="muted">Your cart is empty.</p>';
  return;
}

  const rows = cart.map(it => `
    <div class="cart-line">
      ${it.image ? `<img src="${it.image}" alt="">` : ``}
      <div style="flex:1">
        <div><strong>${it.name}</strong></div>
        <div class="muted">$${it.price.toFixed(2)} × ${it.qty}</div>
      </div>
      <div><strong>$${(it.price * it.qty).toFixed(2)}</strong></div>
    </div>
  `).join("");

  const total = cart.reduce((n, it) => n + it.price * it.qty, 0);
  el.innerHTML = rows + `<p style="text-align:right;margin-top:.5rem"><strong>Total: $${total.toFixed(2)}</strong></p>`;
})();
</script>

  <!-- global helpers -->
  <script defer src="/scripts/global.js"></script>
</body>
</html>
