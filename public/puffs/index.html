<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puff’s Smokehouse — Order Pickup</title>
  <meta name="description" content="Order Puff’s Smokehouse plates and pickup on arrival. Turkey wings, ribs, neck bones, sides and more. Ponchatoula, LA." />
  <link rel="canonical" href="https://www.squarebidness.com/puffs/" />

  <!-- Build stamp (optional but recommended for cache-busting) -->
  <meta name="sb:build" content="v20260108-puffs" />

  <!-- PWA / app metadata -->
  <link rel="manifest" href="/puffs/manifest.webmanifest" />
  <meta name="theme-color" content="#0b0b0b" />

  <!-- Icons / PWA (Puff’s) -->
  <link rel="icon" href="/puffs/icons/icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/puffs/icons/icon-180.png" />

  <!-- Android/Chrome install support (modern replacement) -->
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- iOS add-to-home support (still used on iPhone/iPad) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="Puff’s Smokehouse" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Puff’s Smokehouse" />
  <meta property="og:title" content="Puff’s Smokehouse — Order Pickup" />
  <meta property="og:description" content="Order online, pickup on arrival. Plates include two sides and bread (except pig feet). Ponchatoula, LA." />
  <meta property="og:url" content="https://www.squarebidness.com/puffs/" />
  <meta property="og:image" content="https://www.squarebidness.com/puffs/assets/puffs_hero_1200x630.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Puff’s Smokehouse — Order Pickup" />
  <meta name="twitter:description" content="Order online, pickup on arrival. Ponchatoula, LA." />
  <meta name="twitter:image" content="https://www.squarebidness.com/puffs/assets/puffs_hero_1200x630.jpg" />

  <style>
  :root{
    --bg:#0b0b0b; --card:#111; --ink:#f7f7f7; --muted:#b9b9b9;
    --brand:#ff9f1a; --line:#232323; --accent:#ffd28a; --danger:#ff4d4d;
  }

  *{box-sizing:border-box}

  html,body{
    margin:0;
    background:var(--bg);
    color:#f2f2f2;
    font-family:system-ui,Segoe UI,Roboto,Arial;
  }

  p{ color:#e9e9e9; }
  p.sub{ margin:0; color:#d6d6d6; } /* ✅ single source of truth */

  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  /* ✅ ONE HERO ONLY (no background image) */
  header.hero{
    border-bottom:1px solid var(--line);
    background:linear-gradient(0deg,#000000b3 0%,#00000088 35%,#00000055 60%,#0000 100%);
  }
  header.hero .wrap{padding:14px 16px 10px}

 /* ✅ Desktop: menu + order same width + same height */
.grid{
  display:grid;
  gap:16px;
  grid-template-columns: 1fr 1fr;  /* ✅ same width */
  align-items:stretch;            /* ✅ same height */
}

@media (max-width: 900px){
  .grid{ grid-template-columns:1fr; }
}

/* ✅ Make both cards fill the row height */
#menu.card,
.grid > aside.card{
  height:100%;
}


  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .card h2{margin:0;font-size:1.1rem;padding:12px 14px;border-bottom:1px solid var(--line);background:rgba(255,159,26,.08)}
  .sect{padding:14px}
  .row{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed #222}
  .row:last-child{border-bottom:0}
  .price{opacity:.9;white-space:nowrap}
  .qty{display:flex;align-items:center;gap:6px}
  .qty button{width:28px;height:28px;border-radius:8px;border:1px solid #2a2a2a;background:#141414;color:#fff;cursor:pointer}

  /* ✅ Buttons (contrast bump) */
  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:12px 14px;
    border-radius:12px;
    background:#1b1b1b;
    border:1px solid #3a3a3a;
    color:#fff;
    text-decoration:none;
    cursor:pointer;
  }
  .btn:hover{ background:#232323; border-color:#4a4a4a; }
  .btn:focus-visible{ outline:3px solid rgba(255,159,26,.55); outline-offset:2px; }
  .btn.primary{ background:#fff; color:#000; font-weight:800; border-color:#fff; }

  /* Closed banner + overlay */
  .closedBanner{background:linear-gradient(90deg,#2a0000,#5a0000);color:#fff;border-bottom:1px solid #3a0a0a}
  .closedBanner .wrap{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;padding:10px 16px}
  .overlay{position:fixed;inset:0;background:#000a;backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:40}
  .overlay .box{background:#111;border:1px solid #2b2b2b;border-radius:16px;padding:18px;max-width:560px;margin:16px}
  .overlay h3{margin:0 0 6px}
  .disabled{opacity:.6;pointer-events:none}

  /* Owner panel */
  .owner{display:none;border-top:1px dashed #333;margin-top:12px;padding-top:12px}
  .owner label{display:flex;align-items:center;gap:8px}
  .owner input[type="checkbox"]{transform:scale(1.2)}
  .owner .rowBtns{display:flex;gap:10px;flex-wrap:wrap}
  .owner .signout{margin-left:auto}

  /* Specials bar (CLS-safe) */
  .specialsBar{
    background:linear-gradient(90deg,#2b210f,#1b1b1b);
    border-bottom:1px solid #3a2a0a;
    min-height:44px;
  }
  .specialsBar .wrap{
    padding:10px 16px;
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .specialsBadge{background:var(--brand);color:#000;font-weight:800;padding:4px 10px;border-radius:999px}
  .specialsText{color:#ffe7bf}
  .specialsBar.is-hidden{ visibility:hidden; opacity:0; pointer-events:none; }

  /* ✅ Icon-sized hero (top-left) */
  .hero-shell{display:flex;flex-direction:column;align-items:flex-start;gap:10px;width:auto;margin:0}
  .hero-img{
    display:block;
    width:140px;
    height:auto;
    max-width:none;
    border-radius:20px;
    border:1px solid var(--line);
    background:#111;
  }
  @media (max-width: 480px){ .hero-img{ width:120px; border-radius:18px; } }
</style>
</head>

<body>
  <!-- Closed banner -->
  <div id="closedBanner" class="closedBanner" style="display:none">
    <div class="wrap">
      <strong style="color:var(--accent)">Orders are currently CLOSED</strong>
      <span class="tiny">Please check back during open hours or call <a href="tel:+19859811777" style="color:#fff;text-decoration:underline">(985) 981-1777</a>.</span>
    </div>
  </div>

  <header class="hero">
    <div class="wrap">
      <div class="hero-shell">
        <picture>
          <source srcset="/puffs/assets/puffs_140.webp" type="image/webp" />
          <img
            src="/puffs/assets/puffs_140.png"
            alt="Puff’s Smokehouse"
            width="140"
            height="140"
            loading="eager"
            decoding="async"
            fetchpriority="high"
            class="hero-img"
          />
        </picture>

        <p class="sub">
  Order online — pick up when you arrive. N 3rd St, Ponchatoula, LA 70454 ·
  <a
    href="https://www.google.com/maps/search/?api=1&query=N%203rd%20St%20Ponchatoula%2C%20LA%2070454"
    target="_blank"
    rel="noopener"
    style="color:#fff;text-decoration:underline"
  >Get directions</a>
  <span class="pill">Preview</span>
</p>
      </div>
    </div>
  </header>

 <!-- Specials bar (CLS-safe: keeps height reserved) -->
<div id="specialsBar" class="specialsBar is-hidden" aria-hidden="true">
  <div class="wrap">
    <span class="specialsBadge">Today’s Special</span>
    <span id="specialsText" class="specialsText"></span>
  </div>
</div>

  <main class="wrap grid">
    <!-- MENU -->
    <section class="card" id="menu">
      <h2>Menu</h2>
      <div class="sect" id="menuContent"><!-- injected --></div>
    </section>

    <!-- CART / CHECKOUT -->
    <aside class="card">
      <h2>Your Order</h2>
      <div class="sect">
        <div id="cartLines" class="stack tiny" style="min-height:80px">No items yet.</div>
        <div class="cartTotal"><span class="muted">Subtotal</span><strong id="sub">$0.00</strong></div>
        <div class="cartTotal"><span class="muted">Tax (8.95%)</span><strong id="tax">$0.00</strong></div>
        <div class="cartTotal" style="border-top:1px solid #222;padding-top:6px"><span>Total</span><strong id="tot">$0.00</strong></div>

        <hr style="border:none;border-top:1px solid #222;margin:14px 0">

        <div class="stack">
          <label>Pickup time
            <select id="pickup">
              <option value="ASAP">ASAP</option>
              <option>In 15 minutes</option>
              <option>In 30 minutes</option>
              <option>Top of the hour</option>
            </select>
          </label>
          <label>Your name <input id="custName" placeholder="Name"></label>
          <label>Phone <input id="custPhone" placeholder="(xxx) xxx-xxxx"></label>
          <label>Notes (no onions, extra sauce, etc.) <textarea id="custNotes" rows="3"></textarea></label>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn primary" id="btnText">Text Order</button>
          <button class="btn" id="btnCopy">Copy Summary</button>
          <button class="btn" id="btnClear">Clear</button>
        </div>

        <p class="tiny" style="margin-top:10px">You’ll pay at pickup. Prices and availability subject to change. “Smoked Pig Feet Plate” available <strong>Sunday only</strong>.</p>

        <!-- Owner panel -->
        <div id="ownerPanel" class="owner">
          <div class="rowBtns">
            <label><input type="checkbox" id="toggleClosed"> Mark orders CLOSED</label>
            <button class="btn signout" id="signOut">Sign out</button>
          </div>

          <div class="stack" style="margin-top:12px">
            <label for="ownerSpecials" style="display:block;font-weight:600">Today’s Special (shows in gold bar)</label>
            <textarea id="ownerSpecials" rows="3" placeholder="e.g., Friday: Wing Basket at First Street Park · $12 · 11am–3pm"></textarea>
            <div class="rowBtns">
              <button class="btn" id="saveSpecial">Save Special</button>
              <button class="btn" id="clearSpecial">Clear Special</button>
              <button class="btn" id="copyLink">Copy Promo Link</button>
            </div>
            <div class="tiny">Saved on this device. “Copy Promo Link” creates a shareable URL (adds <code>?special=...</code>) that shows the special for anyone who opens it.</div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <footer class="wrap">
    <div>
      © 2025 Puff’s Smokehouse ·
      <a href="tel:+19859811777" style="color:#fff;text-decoration:underline">(985) 981-1777</a>
      <span style="opacity:.5"> · </span>
      <a id="ownerLogin" href="/puffs/?owner=1&v=2" style="color:#fff;text-decoration:underline">Owner Login</a>
    </div>

    <p style="margin:.85rem 0 0;color:#6b7280;font-size:.85rem;line-height:1.5;">
      Powered by
      <a
        href="https://lab.squarebidness.com/linkme/"
        target="_blank"
        rel="noopener noreferrer"
        style="color:#ff9f1a;text-decoration:underline;font-weight:700;"
        aria-label="Powered by Square Bidness Tech Lab"
      >Square Bidness Tech Lab</a>
    </p>
  </footer>

  <div id="closedOverlay" class="overlay">
    <div class="box">
      <h3 style="color:var(--danger);margin-bottom:8px">Orders are closed</h3>
      <p class="tiny" style="margin:0 0 10px">Online ordering is currently unavailable. Please visit us during open hours or call <a href="tel:+19859811777" style="color:#fff;text-decoration:underline">(985) 981-1777</a>.</p>
      <button class="btn" id="overlayOk">OK</button>
    </div>
  </div>

  <script>
  // ------- BUILD (cache-bust for menu.json) -------
  const BUILD = (document.querySelector('meta[name="sb:build"]')?.content || "v1");

  // ------- DATA -------
  let MENU = [];
  let TAX_RATE = 0.0895;
  let PHONE = "+19859811777";

  // ------- CONFIG: Owner PIN -------
  const ADMIN_PIN = "1777";

  // ------- STORAGE KEYS -------
  const STORAGE_KEY = "puffsClosedFlag";
  const SPECIALS_KEY = "puffsSpecialsText";

  // ------- QUERYSTRING / OWNER MODE -------
  const qs = new URLSearchParams(location.search);

  let ownerMode = sessionStorage.getItem("puffsAdmin") === "1";
  if (qs.get("owner") === "1" && !ownerMode) {
    const entered = prompt("Owner PIN");
    if (entered === ADMIN_PIN) {
      ownerMode = true;
      sessionStorage.setItem("puffsAdmin", "1");
    } else {
      alert("Incorrect PIN.");
    }
  }

  // Force open/closed via URL
  const forceClosed = qs.get("closed") === "1" ? true
                    : qs.get("open") === "1" ? false
                    : null;

  function getClosed() {
    if (forceClosed !== null) return forceClosed;
    return localStorage.getItem(STORAGE_KEY) === "1";
  }

  function applyClosedState(isClosed) {
    const disabledCls = "disabled";
    document.querySelectorAll(".qty button, #btnText, #btnCopy, #btnClear").forEach(el => {
      if (isClosed) el.classList.add(disabledCls);
      else el.classList.remove(disabledCls);
    });
    document.getElementById("closedBanner").style.display = isClosed ? "" : "none";
    document.getElementById("closedOverlay").style.display = isClosed ? "flex" : "none";
    const t = document.getElementById("toggleClosed");
    if (t) t.checked = isClosed;
  }

  function setClosed(v) {
    localStorage.setItem(STORAGE_KEY, v ? "1" : "0");
    applyClosedState(v);
  }

  // ------- SPECIALS -------
 function renderSpecials(text){
  const bar = document.getElementById('specialsBar');
  const el = document.getElementById('specialsText');
  const t = (text || '').trim();

  if (t.length){
    el.textContent = t;
    bar.classList.remove('is-hidden');
    bar.setAttribute('aria-hidden','false');
  } else {
    el.textContent = '';
    bar.classList.add('is-hidden');
    bar.setAttribute('aria-hidden','true');
  }
}

  function saveSpecials(text) {
    localStorage.setItem(SPECIALS_KEY, text || "");
    renderSpecials(text);
  }

  async function loadMenuJSON() {
    const res = await fetch(`/puffs/menu.json?v=${encodeURIComponent(BUILD)}`);
    if (!res.ok) throw new Error("menu.json not found");

    const data = await res.json();

    MENU = Array.isArray(data.sections) ? data.sections : [];
    TAX_RATE = Number.isFinite(Number(data.taxRate)) ? Number(data.taxRate) : 0.0895;
    PHONE = data.phone || "+19859811777";

    // Specials: URL overrides JSON
    const specialFromLink = qs.get("special");
    if (specialFromLink) renderSpecials(decodeURIComponent(specialFromLink));
    else renderSpecials(data.special || "");

    // Open/Closed: JSON unless URL override
    const closedFromJSON = data.open === false;

    if (forceClosed === null) {
      localStorage.setItem(STORAGE_KEY, closedFromJSON ? "1" : "0");
      applyClosedState(closedFromJSON);
    } else {
      applyClosedState(getClosed());
    }

    return data;
  }

  // ------- OWNER PANEL -------
  if (ownerMode) {
    document.getElementById("ownerPanel").style.display = "block";

    const toggle = document.getElementById("toggleClosed");
    toggle.checked = getClosed();
    toggle.addEventListener("change", (e) => setClosed(e.target.checked));

    const box = document.getElementById("ownerSpecials");
    box.value = localStorage.getItem(SPECIALS_KEY) || "";

    document.getElementById("saveSpecial").onclick = () => saveSpecials(box.value);
    document.getElementById("clearSpecial").onclick = () => { box.value = ""; saveSpecials(""); };

    document.getElementById("copyLink").onclick = () => {
      const txt = (box.value || "").trim();
      if (!txt) { alert("Enter a special first."); return; }
      const url = new URL(location.href.split("#")[0]);
      url.searchParams.set("special", txt);
      url.searchParams.delete("owner");
      navigator.clipboard.writeText(url.toString())
        .then(() => alert("Promo link copied!"))
        .catch(() => alert("Copy failed."));
    };

    document.getElementById("signOut").onclick = () => {
      sessionStorage.removeItem("puffsAdmin");
      location.href = location.pathname;
    };
  }

  document.getElementById("overlayOk").onclick = () => {
    document.getElementById("closedOverlay").style.display = "none";
  };

  // ------- CART -------
  const cart = new Map();

  function money(n) { return `$${n.toFixed(2)}`; }

  function renderMenu() {
    const $menu = document.getElementById("menuContent");
    $menu.innerHTML = "";

    MENU.forEach(sec => {
      const wrap = document.createElement("section");
      wrap.className = "stack";

      const h = document.createElement("h3");
      h.textContent = sec.section || "";
      h.style.margin = "0";
      h.style.fontSize = "1.05rem";
      wrap.append(h);

      if (sec.note) {
        const n = document.createElement("div");
        n.className = "note";
        n.textContent = sec.note;
        wrap.append(n);
      }

      (sec.items || []).forEach(item => {
        const row = document.createElement("div");
        row.className = "row";

        const name = document.createElement("div");
        name.innerHTML =
          `<strong>${item.name || ""}</strong>` +
          (item.subnote ? `<div class="tiny muted">${item.subnote}</div>` : "") +
          (item.badge ? ` <span class="pill" style="margin-left:6px">${item.badge}</span>` : "");

        const price = document.createElement("div");
        price.className = "price";
        price.textContent = `$${Number(item.price || 0)}`;

        const qty = document.createElement("div");
        qty.className = "qty";

        const minus = document.createElement("button");
        minus.type = "button";
        minus.textContent = "–";

        const v = document.createElement("span");
        v.textContent = "0";
        v.style.minWidth = "16px";
        v.style.textAlign = "center";
        v.dataset.bindQty = item.id;

        const plus = document.createElement("button");
        plus.type = "button";
        plus.textContent = "+";

        minus.onclick = () => update(item.id, -1);
        plus.onclick = () => update(item.id, +1);

        qty.append(minus, v, plus);
        row.append(name, price, qty);
        wrap.append(row);
      });

      $menu.append(wrap);
    });
  }

  function renderCart() {
    const $lines = document.getElementById("cartLines");
    $lines.innerHTML = "";
    let sub = 0;

    for (const sec of MENU) {
      for (const item of (sec.items || [])) {
        const q = cart.get(item.id) || 0;
        if (!q) continue;

        const p = Number(item.price || 0);
        const left = document.createElement("div");
        left.textContent = `${q} × ${item.name}`;

        const right = document.createElement("div");
        right.textContent = money(q * p);

        const flex = document.createElement("div");
        flex.style.display = "flex";
        flex.style.justifyContent = "space-between";
        flex.append(left, right);

        $lines.append(flex);
        sub += q * p;
      }
    }

    if (sub === 0) $lines.textContent = "No items yet.";

    const tax = sub * TAX_RATE;
    const tot = sub + tax;

    document.getElementById("sub").textContent = money(sub);
    document.getElementById("tax").textContent = money(tax);
    document.getElementById("tot").textContent = money(tot);
  }

  function update(id, delta) {
    if (getClosed()) { applyClosedState(true); return; }

    const q = Math.max(0, (cart.get(id) || 0) + delta);
    if (q === 0) cart.delete(id);
    else cart.set(id, q);

    const qtySpan = document.querySelector(`[data-bind-qty="${CSS.escape(id)}"]`);
    if (qtySpan) qtySpan.textContent = q;

    renderCart();
  }

  // Buttons
  document.getElementById("btnClear").onclick = () => {
    if (getClosed()) { applyClosedState(true); return; }
    cart.clear();
    document.querySelectorAll("[data-bind-qty]").forEach(s => s.textContent = "0");
    renderCart();
  };

  document.getElementById("btnCopy").onclick = () => {
    if (getClosed()) { applyClosedState(true); return; }
    const summary = buildSummary();
    navigator.clipboard.writeText(summary).then(() => alert("Order copied.")).catch(() => alert("Copy failed"));
  };

  document.getElementById("btnText").onclick = () => {
    if (getClosed()) { applyClosedState(true); return; }
    if (cart.size === 0) { alert("Add something to the cart first."); return; }
    const summary = encodeURIComponent(buildSummary());
    window.location.href = `sms:${PHONE}?&body=${summary}`;
  };

  function buildSummary() {
    const when = document.getElementById("pickup").value;
    const name = document.getElementById("custName").value || "—";
    const phone = document.getElementById("custPhone").value || "—";
    const notes = document.getElementById("custNotes").value || "—";

    let lines = [
      "Puff’s Smokehouse — Pickup Order",
      `Pickup: ${when}`,
      `Name: ${name}`,
      `Phone: ${phone}`,
      "",
      "Items:"
    ];

    let sub = 0;
    for (const sec of MENU) {
      for (const item of (sec.items || [])) {
        const q = cart.get(item.id) || 0;
        if (!q) continue;
        const p = Number(item.price || 0);
        lines.push(`• ${q} × ${item.name}  $${(q * p).toFixed(2)}`);
        sub += q * p;
      }
    }

    const tax = sub * TAX_RATE;
    const tot = sub + tax;

    lines.push(
      "",
      `Subtotal: $${sub.toFixed(2)}`,
      `Tax: $${tax.toFixed(2)}`,
      `Total: $${tot.toFixed(2)}`,
      "",
      `Notes: ${notes}`,
      "",
      "Sent from SquareBidness.com/puffs"
    );

    return lines.join("\n");
  }

  // Boot
  (async function boot() {
    try {
      await loadMenuJSON();
      renderMenu();
      renderCart();
      applyClosedState(getClosed());
    } catch (e) {
      console.warn("[puffs] boot failed:", e);
      const $menu = document.getElementById("menuContent");
      if ($menu) $menu.innerHTML = `<div class="tiny" style="color:#ffb3b3">Menu failed to load. Please refresh.</div>`;
      renderCart();
      applyClosedState(getClosed());
    }
  })();
  </script>

  <!-- Owner Login link rewriter -->
  <script>
  (function () {
    const link = document.getElementById("ownerLogin");
    if (!link) return;

    const base = new URL(window.location.origin + "/puffs/");
    const current = new URL(window.location.href);

    current.searchParams.forEach((val, key) => {
      if (key !== "owner") base.searchParams.set(key, val);
    });

    base.searchParams.set("owner", "1");
    base.searchParams.set("v", "2");

    link.href = base.pathname + "?" + base.searchParams.toString();
  })();
  </script>

  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/puffs/sw.js", { scope: "/puffs/" }).catch(()=>{});
  }
  </script>
</body>
</html>
