<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Performance: open connections early -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.google-analytics.com">

  <!-- GA4 (site-wide loader) -->
  <script defer src="/public/scripts/ga.js"></script>

  <!-- Basics -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shop — Square Bidness Apparel</title>
  <link rel="canonical" href="https://www.squarebidness.com/shop/" />
  <base href="/" /> <!-- forces relative URLs to resolve from site root -->

  <!-- GLOBAL CSS (you actually stored it under /public) -->
  <link rel="stylesheet" href="/styles/style.css" />

  <!-- SEO -->
  <meta name="description" content="Shop the latest drops from Square Bidness Apparel. Explore exclusive collections, premium fabrics, and limited-run pieces like the VSOP Collection." />
  <meta name="keywords" content="Square Bidness shop, Square Bidness apparel, fashion, clothing, VSOP, Square Bidness store" />
  <meta name="robots" content="index,follow">

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Square Bidness Apparel">
  <meta property="og:title" content="Shop Square Bidness Apparel" />
  <meta property="og:description" content="Discover Square Bidness collections. Premium quality, veteran-owned, Louisiana-raised fashion." />
  <meta property="og:url" content="https://www.squarebidness.com/shop/" />
  <meta property="og:image" content="https://www.squarebidness.com/assets/sb-social-card_1200.jpg" />
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Shop Square Bidness Apparel" />
  <meta name="twitter:description" content="Exclusives, drops, and culture. Veteran-owned, Louisiana-raised." />
  <meta name="twitter:image" content="https://www.squarebidness.com/assets/sb-social-card_1200.jpg" />
  <meta name="twitter:site" content="@squarebidnesstm" />

  <!-- PWA / theming -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="/assets/icons/icon-180.png">
  <!-- you moved this into /public/ -->
  <link rel="manifest" href="/public/site.webmanifest">
  <meta name="theme-color" content="#000000">

  <!-- Organization JSON-LD (site-wide) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"Square Bidness Apparel",
    "url":"https://www.squarebidness.com/",
    "logo":"https://www.squarebidness.com/assets/cleantextlogo.png",
    "sameAs":[
      "https://instagram.com/squarebidnesstm",
      "https://www.tiktok.com/@squarebidnesstm",
      "https://www.facebook.com/squarebidnessapparel",
      "https://bsky.app/profile/squarebidnesstm.bsky.social",
      "https://www.linkedin.com/company/square-bidness-apparel"
    ],
    "contactPoint":[
      {
        "@type":"ContactPoint",
        "contactType":"customer support",
        "email":"squarebidnessapparel@gmail.com",
        "areaServed":"US"
      }
    ]
  }
  </script>

  <!-- Site-wide cart core -->
  <script src="/public/scripts/sb-cart.js" defer></script>
</head>

<body class="theme-dark" id="top">
  <!-- LOGO + NAV -->
  <div class="logo-wrapper">
    <a href="/">
      <img src="/assets/cleantextlogo.png" alt="Square Bidness Logo" class="logo-img" />
    </a>
  </div>

  <!-- PAGE HERO -->
  <header class="page-hero">
    <div class="container">
      <h1 class="page-title">Shop Square Bidness</h1>
      <p class="page-subtitle">Exclusives. Drops. Legacy in Fabric.</p>
    </div>
  </header>

  <main class="section">
    <div class="container">

      <!-- Filter Chips -->
      <div class="shop-filters">
        <button class="chip is-active" data-filter="all">All</button>
        <button class="chip" data-filter="vsop">VSOP</button>
        <button class="chip" data-filter="tees">Tees</button>
        <button class="chip" data-filter="hats">Hats</button>
      </div>

      <!-- PRODUCT GRID -->
      <div class="grid vsop-grid">
        <!-- Jacket card -->
        <article class="card" data-product-id="vsop-jacket" data-category="vsop">
          <div class="card__media">
            <img 
              loading="lazy" 
              src="/assets/vsop-jacket.jpg"
              width="800" 
              height="1000"
              alt="VSOP embroidered hooded jacket in burgundy and brown"
              data-skeleton="product"
              onerror="this.onerror=null;this.src='/assets/placeholder.png';">  
            <span class="badge badge--available">Multiple Sizes Available</span>
          </div>

          <div class="card__content">
            <h3><a href="/product-vsop-jacket/">VSOP Hooded Jacket</a></h3>
            <p class="card__description">Burgundy + Brown. Premium fabric. Embroidered.</p>
            <p class="price">$129.99</p>
          </div>

          <div class="card__actions">
            <a
              class="btn btn--gold btn--primary"
              href="/product-vsop-jacket/"
              aria-label="VSOP Hooded Jacket — choose size and add to cart"
              data-product-id="vsop-jacket">
              Choose Size & Add to Cart
            </a>
            <a
              class="btn btn--ghost btn--secondary"
              href="/product-vsop-jacket/"
              aria-label="VSOP Hooded Jacket — view details"
              data-product-id="vsop-jacket">
              View Details
            </a>
          </div>
        </article>

        <!-- Shorts card -->
        <article class="card" data-product-id="vsop-shorts" data-category="vsop">
          <div class="card__media">
            <img
              loading="lazy"
              src="/assets/vsop-shorts.jpg"
              width="800"
              height="1000"
              alt="VSOP matching shorts in burgundy and brown"
              data-skeleton="product"
              onerror="this.onerror=null;this.src='/assets/placeholder.png';">
            <span class="badge badge--available">Multiple Sizes Available</span>
          </div>

          <div class="card__content">
            <h3><a href="/product-vsop-shorts/">VSOP Shorts</a></h3>
            <p class="card__description">Burgundy + Brown. Embroidered mark. Athletic fit.</p>
            <p class="price">$89.99</p>
          </div>

          <div class="card__actions">
            <a class="btn btn--gold btn--primary"
               href="/product-vsop-shorts/"
               aria-label="VSOP Shorts — choose size and add to cart"
               data-product-id="vsop-shorts">
              Choose Size & Add to Cart
            </a>
            <a class="btn btn--ghost btn--secondary"
               href="/product-vsop-shorts/"
               aria-label="VSOP Shorts — view details"
               data-product-id="vsop-shorts">
              View Details
            </a>
          </div>
        </article>

        <!-- Collection card -->
        <article class="card" data-category="vsop">
          <div class="card__media">
            <img loading="lazy" src="/assets/hero.jpg" width="1600" height="900"
                 alt="VSOP look — jacket with matching shorts"
                 onerror="this.onerror=null;this.src='/assets/placeholder-wide.png';">
          </div>
          <div class="card__content">
            <h3>Full VSOP Look</h3>
            <p class="card__description">Complete the set with both pieces</p>
          </div>
          <div class="card__actions">
            <a class="btn btn--gold btn--primary" href="/collection-vsop.html">Shop Collection</a>
          </div>
        </article>

        <!-- Women's Collection -->
        <article class="product-card" data-product-id="womens-comingsoon" data-category="womens">
          <a href="#" class="thumb">
            <img loading="lazy" src="/assets/womens-comingsoon.png" width="1200" height="1200"
                 alt="Women's Collection"
                 onerror="this.onerror=null;this.src='/assets/placeholder.png';">
            <span class="badge badge--coming-soon">Coming Soon</span>
          </a>
          <h3 class="title">Women's Collection</h3>
          <p class="desc">Style redefined. Comfort tailored. Coming soon.</p>
          <div class="meta">
            <span class="price">Coming Soon</span>
            <a class="btn btn--ghost" href="#">Details</a>
          </div>
        </article>

        <!-- Kids' Collection -->
        <article class="product-card" data-product-id="kids-comingsoon" data-category="kids">
          <a href="#" class="thumb">
            <img loading="lazy" src="/assets/kids-comingsoon.png" width="1200" height="1200"
                 alt="Kids' Collection"
                 onerror="this.onerror=null;this.src='/assets/placeholder.png';">
            <span class="badge badge--coming-soon">Coming Soon</span>
          </a>
          <h3 class="title">Kids' Collection</h3>
          <p class="desc">Durable, stylish, and designed for play. Stay tuned.</p>
          <div class="meta">
            <span class="price">Coming Soon</span>
            <a class="btn btn--ghost" href="#">Details</a>
          </div>
        </article>
      </div>

      <!-- Back to top -->
      <div class="section__cta">
        <a class="btn btn--ghost" href="#top">⬆️ Back to Top</a>
      </div>
    </div>
  </main>

  <!-- FOOTER include hook -->
  <div id="footer-placeholder"></div>

  <!-- Skeleton script (unchanged) -->
  <script>
  (() => {
    const $all = (s, r=document) => Array.from(r.querySelectorAll(s));
    function addSkeleton(img) {
      img.setAttribute('aria-busy', 'true');
      img.classList.add('img-skeleton');
      const done = () => {
        img.classList.remove('img-skeleton');
        img.removeAttribute('aria-busy');
        img.removeEventListener('load', done);
        img.removeEventListener('error', done);
      };
      img.addEventListener('load', done);
      img.addEventListener('error', done);
      if (img.complete && img.naturalWidth > 0) done();
    }
    const io = ('IntersectionObserver' in window)
      ? new IntersectionObserver((entries) => {
          entries.forEach(({ isIntersecting, target }) => {
            if (!isIntersecting) return;
            io.unobserve(target);
            addSkeleton(target);
          });
        }, { rootMargin: '200px 0px' })
      : null;
    const imgs = $all('.card__media img, .product-card .thumb img, .page-hero img, .hero__media img');
    imgs.forEach(img => {
      if (img.complete && img.naturalWidth > 0) return;
      if (io) io.observe(img); else addSkeleton(img);
    });
  })();
  </script>

  <!-- Scripts -->
  <script>
    // Simple filter functionality
    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('is-active'));
        chip.classList.add('is-active');

        const filter = chip.dataset.filter;
        const cards = document.querySelectorAll('.card, .product-card');
        cards.forEach(card => {
          card.style.display = (filter === 'all' || card.dataset.category === filter) ? '' : 'none';
        });
      });
    });

    // Product data hydration
    fetch('/public/products.json')
      .then(r => r.ok ? r.json() : Promise.reject(r.status))
      .then(data => {
        document.querySelectorAll('[data-product-id]').forEach(card => {
          const id = card.getAttribute('data-product-id');
          const p = data[id];
          if (!p) return;

          const title = card.querySelector('.title a, h3 a, h3');
          const desc = card.querySelector('.desc, .card__description');
          const img = card.querySelector('img');
          const price = card.querySelector('.price');

          if (title && p.name) title.textContent = p.name;
          if (desc && p.desc) desc.textContent = p.desc;
          if (img && p.image) img.src = p.image;
          if (price && typeof p.price === 'number') price.textContent = `$${p.price.toFixed(2)}`;

          const badge = card.querySelector('.badge');
          const primaryBtn = card.querySelector('.btn--primary');

          if (badge && primaryBtn) {
            card.classList.remove('card--disabled');
            badge.className = 'badge';
            if (p.status === 'in-stock') {
              badge.textContent = 'Multiple Sizes Available';
              badge.classList.add('badge--available');
              primaryBtn.textContent = 'Choose Size & Add to Cart';
            } else if (p.status === 'low-stock') {
              badge.textContent = `Only ${p.stock || 3} Left`;
              badge.classList.add('badge--low-stock');
              primaryBtn.textContent = 'Choose Size & Add to Cart';
            } else if (p.status === 'sold-out') {
              badge.textContent = 'Sold Out';
              badge.classList.add('badge--sold-out');
              primaryBtn.textContent = 'Out of Stock';
              card.classList.add('card--disabled');
            } else if (p.status === 'coming-soon') {
              badge.textContent = 'Coming Soon';
              badge.classList.add('badge--coming-soon');
              primaryBtn.textContent = 'Notify When Available';
            }
          }
        });
      })
      .catch(() => { /* ignore if file missing */ });
  </script>

  <!-- GA4 ecommerce (unchanged) -->
  <script>
  (() => {
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const toPrice = el => Number((el?.textContent || '').replace(/[^0-9.]/g, '')) || 0;

    const getItemFromCard = (card) => {
      if (!card) return null;
      const id = card.getAttribute('data-product-id') || 'unknown';
      const name = card.querySelector('h3')?.textContent?.trim() || 'Unknown';
      const price = toPrice(card.querySelector('.price'));
      const category = card.getAttribute('data-category') || undefined;
      return { item_id: id, item_name: name, price, item_category: category };
    };

    const cards = $$('.card, .product-card');
    if (cards.length) {
      const items = cards.map(getItemFromCard).filter(Boolean)
        .map((item, idx) => ({ ...item, index: idx + 1, quantity: 1 }));
      window.gtag?.('event', 'view_item_list', { item_list_name: 'Shop Grid', items });
    }

    document.addEventListener('click', (e) => {
      const link = e.target.closest('h3 a, .btn--secondary[data-product-id]');
      if (!link) return;
      const card = link.closest('[data-product-id], .card, article');
      const item = getItemFromCard(card);
      if (!item) return;
      window.gtag?.('event', 'select_item', { item_list_name: 'Shop Grid', items: [{ ...item, quantity: 1 }] });
    }, { passive: true });

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.btn--primary[data-product-id]');
      if (!btn) return;
      const card = btn.closest('[data-product-id], .card, article');
      const item = getItemFromCard(card);
      if (!item) return;
      window.gtag?.('event', 'add_to_cart', { currency: 'USD', value: item.price || 0, items: [{ ...item, quantity: 1 }] });
    }, { passive: true });
  })();
  </script>

  <!-- Inject nav/footer + mark active link -->
  <script>
  (async () => {
    const bust = `?v=${Date.now()}`;

    async function injectPartial(url, targetId) {
      try {
        const res = await fetch(url + bust, { credentials: 'same-origin' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const html = await res.text();
        const el = document.getElementById(targetId);
        if (el) { el.innerHTML = html; el.classList.add('fade-in'); }
        return el;
      } catch (e) {
        console.warn(`Failed to load ${url}:`, e);
        return null;
      }
    }

    // NAV (you put it under /public/nav/index.html)
    const navEl = await injectPartial('/public/nav/index.html', 'nav-placeholder');

    if (navEl) {
      const current = location.pathname.replace(/\/+$/, '') || '/';
      navEl.querySelectorAll('a[href]').forEach(a => {
        try {
          const href = new URL(a.getAttribute('href'), location.origin).pathname.replace(/\/+$/, '') || '/';
          if (href === current || (href !== '/' && current.startsWith(href))) {
            a.classList.add('is-active');
            a.setAttribute('aria-current', 'page');
          }
        } catch {}
      });
    }

    // FOOTER (you put it under /public/footer/index.html)
    await injectPartial('/public/footer/index.html', 'footer-placeholder');
  })();
  </script>

</body>
</html>
